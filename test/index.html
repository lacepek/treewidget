<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
</head>

<body>
    <div id="tree-widget-wrapper" class="container"></div>

    <script src="../dist/treewidget.js"></script>

    <script>
        var structure = {
            'oblast': {
                'name': 'oblast',
                'label': 'oblast',
                'parent': null,
                'config': {
                    'useModalEdit': true,
                    'addLineText': 'Přidat oblast',
                },
                'items': {
                    'tdotconsek_pk': { 'type': 'text', 'isHidden': true },
                    'tdotconsek_nazev': { 'type': 'text', 'label': 'tdotconsek_nazev' },
                    'tdotconsek_popis': { 'type': 'text', 'label': 'Popis' }
                }
            },
            'kategorie': {
                'name': 'kategorie',
                'label': 'kategorie',
                'parent': 'oblast',
                'config': {
                    'addLineText': 'Přidat kategorii',
                    'useModalEdit': true,
                },
                'items': {
                    'tdotconpsk_pk': { 'type': 'text', 'isHidden': true },
                    'tdotconpsk_nazev': { 'type': 'text', 'label': 'Nazev' },
                    'tdotconpsk_popis': { 'type': 'text', 'label': 'Popis' }
                }
            },
            'otazka': {
                'name': 'otazka',
                'label': 'otázka',
                'parent': 'kategorie',
                'useModalEdit': true,
                'config': {
                    'isSortable': true,
                    'useModalEdit': true,
                    'sortFunction': (itemA, itemB) => {
                        if (itemA.item.druh && itemA.item.druh === 'text')
                        {
                            return 1;
                        } else
                        {
                            return -1;
                        }
                    }
                },
                'items': {
                    'pk': { 'type': 'text', 'isHidden': true },
                    'nazev': { 'name': 'nazev', 'type': 'text', 'label': 'Otázka' },
                    'druh': {
                        'name': 'druh',
                        'type': 'select',
                        'label': 'Druh otázky',
                        'defaultValue': 'skala',
                        'options': {
                            'skala': { 'key': 'skala', 'value': 'Otazka na skale' },
                            'text': { 'key': 'text', 'value': 'Volny text' }
                        }
                    },
                    'dulezitost': {
                        'name': 'dulezitost',
                        'type': 'radio',
                        'label': 'Dulezitost',
                        'options': {
                            'ano': { 'key': 'ano', 'value': 'Ano' },
                            'ne': { 'key': 'ne', 'value': 'Ne' }
                        }
                    }
                }
            },
        };

        var data = [
            {
                'item': {
                    'nazev': 'Parent 1',
                    'popis': 'Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Lorem ipsum dolor sit amet, consectetuer adipiscing elit.',
                    'pk': 693
                },
                'children': [
                    {
                        'item': {
                            'tdotconpsk_nazev': 'Child 1',
                            'tdotconpsk_popis': 'Lorem ipsum dolor sit amet, consectetuer adipiscing elit.',
                            'tdotconpsk_pk': 18
                        },
                        'children': [
                            {
                                'item': { 'nazev': 'Grandchild 12', 'druh': 'text', 'pk': 4 },
                            },
                            {
                                'item': { 'nazev': 'Grandchild 1', 'druh': 'skala', 'dulezitost': 'ano', 'pk': 1 },
                            },
                            {
                                'item': { 'nazev': 'Grandchild 2', 'druh': 'skala', 'dulezitost': 'ano', 'pk': 3 },
                            },
                            {
                                'item': { 'nazev': 'Grandchild 3', 'druh': 'skala', 'dulezitost': 'ne', 'pk': 2 },
                            },
                            {
                                'item': { 'nazev': 'Grandchild 4', 'druh': 'text', 'pk': 4 },
                            }
                        ]
                    },
                    {
                        'item': {
                            'tdotconpsk_nazev': 'Child 2',
                            'tdotconpsk_popis': 'Lorem ipsum dolor sit amet, consectetuer adipiscing elit.',
                            'tdotconpsk_pk': 45
                        },
                        children: [
                            {
                                item: { nazev: 'Grandchild 5', druh: 'skala', dulezitost: 'ano', pk: 'otazka-1' },
                            },
                            {
                                item: { nazev: 'Grandchild 6', druh: 'skala', dulezitost: 'ano', pk: 'otazka-2' },
                            },
                        ]
                    }
                ],
            },
            {
                'item': {
                    'tdotconsek_nazev': 'Parent 2',
                    'tdotconsek_popis': 'Lorem ipsum dolor sit amet, consectetuer adipiscing elit.',
                    'tdotconsek_pk': 15
                },
            }
        ];

        TreeWidget.create({
            parentSelector: '#tree-widget-wrapper',
            data: data,
            structure: structure,
            config: {
                canEdit: true,
                canAdd: false,
            },
            events: {
                onLineClick: (data, item) => { /*console.log(data); console.log(item)*/ },
                onLineMove: (data, item) => { /*console.log(data); console.log(item)*/ },
                onLineAddSubmit: async (model) => {
                    console.log(model);

                    model.pk = Math.floor(Math.random() * 100000);

                    return { model, isValid: true };
                },
                onLineEditSubmit: async (model) => {
                    console.log(model);

                    return { model, isValid: true };
                }
            },
        });
    </script>
</body>

</html>